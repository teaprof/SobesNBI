# SobesNBI

The solution of some integer optimization problem

# Files

* crash_test.py - crash test (very long)
* extended.py - extensions (part 2 of the task)
* LICENSE - MIT license
* main.py - main script
* problem.csv - sample problem
* problem.py - problem description 
* problem.schedlang - sample problem written on DSL (domain specific language)
* README.md - this file
* solver.py - solver
* test_solver.py - manually written tests for solver
* Цифровой планировщик.pdf - the original problem solved in this project


# How to run

Just run from the command line:
```
python3 main.py
```

This script will read `problem.csv`, solve the problem and print the solution. The csv-formatted table should have the following columns:
* `t` is the time required to process product,
* `d` is the deadline,
* `p` is the prize (reward) if the product is ready before deadline.
The number of products equals the number of rows.

Below is an example of csv-file:
```
0.417022004702574, 2.424675303015106, 0.14038693859523377
0.7203244934421581, 1.8863753148148266, 0.1981014890848788
0.00011437481734488664, 3.083487751785418, 0.8007445686755367
0.30233257263183977, 0.9200351237918285, 0.9682615757193975
0.14675589081711304, 3.9515284637592543, 0.31342417815924284
0.0923385947687978, 0.12324416939066773, 0.6923226156693141
0.1862602113776709, 3.01710379580281, 0.8763891522960383
0.34556072704304774, 1.8778716106520714, 0.8946066635038473
0.39676747423066994, 2.5141042280058823, 0.08504421136977791
```

The solution is printed on the screen and has a form:
```
Schedule (solution):
[5, 2, 4, 7, 3, 1, 8, 0, 6]
Reward 4.969281393073268 out of 4.969281393073267
```
The schedule shows the order in which products are processed. Reward is a sum of all prizes got for all products finished before the deadline has expired. The second number is the total unconditional sum of prizes for all products. This plays a role of the upper bound limit for the actual reward. In the case above, the actual reward is equal to the max possible reward.

# How to run tests

Just run
```
pytest
```
with no arguments. These tests are generated by-hands and check solver on the set of problems with known solutions.


# What is crash test

Crash test is a sequence of randomly generated problems that are solved by two independent solvers: pulp-based solver (aka `PulpSolver`) and brute-force solver. The brute-force solver is based on the enumeration of all possible schedules and then choosing the best one. The crash test can be run with the following command:
```
python3 crash_test.py
```

# Extensions

The extensions corresponds to the part 2 of the original task (see `Цифровой планировщик.pdf`). They are represented in `extended.py`. This file contains `ExtendedProblem` and `ExtendedPulpSolver` classes which extends `Problem` and `PulpSolver` classes with constraints of a new type and fines. The constraint of the new type requires that some product should be processed before another one. The fines are subtracted from the total reward if the product is got ready after the deadline has expired.

This module also includes parser for Backus-Naur form domain-specific language (BNF DSL) that is suited to describe problems with extended constraints and fines.

To run extended module, print
```
python3 extended.py
```

It will read and parse `problem.schedlang` file, run extended pulp-based solver and compare the solution with brute force solution.


## Schedlang

The example of problem is presented below

```
# format: prod_name = t, d, p
# prod_name - is arbitrary name for product (letters + digits, starts from letter)
# t - duration, d - deadline, p - award
product prod0 = 0.417022004702574, 2.424675303015106, 0.14038693859523377
product prod1 = 0.7203244934421581, 1.8863753148148266, 0.1981014890848788
product prod2 = 0.00011437481734488664, 3.083487751785418, 0.8007445686755367
product prod3 = 0.30233257263183977, 0.9200351237918285, 0.9682615757193975
product prod4 = 0.14675589081711304, 3.9515284637592543, 0.31342417815924284
product prod5 = 0.0923385947687978, 0.12324416939066773, 0.6923226156693141
product prod6 = 0.1862602113776709, 3.01710379580281, 0.8763891522960383
product prod7 = 0.34556072704304774, 1.8778716106520714, 0.8946066635038473
product prod8 = 0.39676747423066994, 2.5141042280058823, 0.08504421136977791

# format: prod_name_1 before prod_name_1
prod2 before prod3
prod8 before prod0

# format: fine for prod_name is f
fine for prod0 is 1.0
fine for prod2 is 1
fine for prod5 is 10
```

